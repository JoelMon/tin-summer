#!/usr/bin/env ion
cargo run --bin sniff -- sort -t1M
cargo run --bin sniff -- fat
cargo run --bin sniff -- sort src/ # to make sure non-ascii displays correctly
cargo build --release

let binpath = target/release/sniff

# set to a suitable path
let path_arg = "false"
for x in @args
    if test $x = "--path"
        let path_arg = "true"
    end
end
if test $path_arg = "true"
    let path = @args[2]
else
    let path = /home/vanessa/programming/haskell/forks/cabal
end

# initialize cache
echo 'initializing file system cache...'
sniff all $path > /dev/null

#do the actual benchmarks
let benches = ["sniff fat $path" "$binpath fat $path" "sniff sort $path" "$binpath sort $path" "sniff ar --sort $path" "$binpath ar --sort $path"]
bench @benches
